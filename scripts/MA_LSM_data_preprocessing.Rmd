---
title: "MA_LSM_data_preprocessing"
author: "Siegel"
date: "2023-11-14"
output: html_document
---
# packages
```{r}
# load packages
   library(here)  
   library(tidyverse) 
   library(writexl)
   library(dplyr)
```

# load data
```{r}
here::here()
load(here("./RData/df_subsample_n41.RData"))
data_raw <- df_subsample
```

# Data cleaning and preparing data frame
```{r}
# rename "ID" into "RegistryCode"
data_raw <- data_raw %>% 
  rename(RegistryCode = ID)

# add "sub" (subject) to the RegistryCode (ID)
data_raw$RegistryCode <- paste("sub", data_raw$RegistryCode)
   
## Create as well as calculate variable 'Weeks since Onset (WSO)'
# Define variables 'test' and 'onset' as dates
data_raw$Test <- as.Date(data_raw$Test, format = "%d.%m.%y")
data_raw$Onset <- as.Date(data_raw$Onset, format = "%d.%m.%y")

# Calculate 'WSO' and define variable as a numeric data type
data_raw$WSO <- difftime(data_raw$Test, data_raw$Onset, units = "weeks")
data_raw$WSO <- as.numeric(data_raw$WSO)

# remove NA trials (accuracy) --> participants were too slow to react on time or didn't react at all
data_raw <- filter(data_raw, !(is.na(accuracy)))

# remove RTs before picture was shown (equals rt = 0) and RTs below 100 ms
data_raw <- data_raw[!(data_raw$response_time_absolute < data_raw$time_picture),]
data_raw <- data_raw[!(data_raw$response_time < 100),]

# make numeric variable for accuracy
data_raw$accuracy_num <- ifelse(data_raw$accuracy == "correct", 1, ifelse(data_raw$accuracy == "incorrect", 0, NA))
```

# Create .csv-dataframe for accuracy (condition; SVR-LSM)
```{r}
# Create new data frame with relevant variables 
data_acc_cond_SVR <- data_raw[c('RegistryCode',
                                'Age',
                                'WSO',
                                'Lesion_volume',
                                'condition',
                                'accuracy_num')]

# Calculate mean of accuracy for each participant
df_acc_cond_summary_SVR <- data_acc_cond_SVR %>% 
  group_by(RegistryCode, condition) %>% 
  mutate(average_accuracy = mean(accuracy_num)) %>% 
  dplyr::select(-accuracy_num) %>% 
  distinct()

# Bring it into wide-format
df_acc_cond_summary_SVR <- df_acc_cond_summary_SVR %>% 
  pivot_wider(names_from = condition, values_from = average_accuracy)

# Extract data frame "data_acc_cond"
write.csv(df_acc_cond_summary_SVR, here("./RData/data_acc_cond.csv"), row.names = F)
```

# Create .xlsx-dataframe for accuracy (condition; NiiStat)
```{r}
# Create new data frame with relevant variables 
data_acc_cond_NiiStat <- data_raw[c('RegistryCode',
                                    'Age',
                                    'WSO',
                                    'condition',
                                    'accuracy_num')]

# Calculate mean of accuracy for each participant
df_acc_cond_summary_NiiStat <- data_acc_cond_NiiStat %>% 
  group_by(RegistryCode, condition) %>% 
  mutate(average_accuracy = mean(accuracy_num)) %>% 
  select(-accuracy_num) %>% 
  distinct()

# Bring it into wide-format
df_acc_cond_summary_NiiStat <- df_acc_cond_summary_NiiStat %>% 
  pivot_wider(names_from = condition, values_from = average_accuracy)

# Extract data frame "data_acc_cond.xlsx"
write_xlsx(df_acc_cond_summary_NiiStat, here("./RData/data_acc_cond.xlsx"))
```

# Create .csv-dataframe for response time (condition; SVR-LSM)
```{r}
# remove incorrect trials from data frame
data_rt_cond_SVR <- filter(data_raw, accuracy == "correct")

# create data frame with relevant variables 
data_rt_cond_SVR <- data_rt_cond_SVR[c('RegistryCode',
                                       'Age',
                                       'WSO',
                                       'Lesion_volume',
                                       'condition',
                                       'response_time')]

# log-transform response time
data_rt_cond_SVR$response_time_log <- log(data_rt_cond_SVR$response_time)

# Calculate mean of response time for each participant
df_rt_cond_summary_SVR <- data_rt_cond_SVR %>% 
  group_by(RegistryCode, condition) %>% 
  mutate(average_rt_log = mean(response_time_log)) %>% 
  dplyr::select(-c("response_time_log", "response_time")) %>% 
  distinct()

# Bring it into wide-format
df_rt_cond_summary_SVR <- df_rt_cond_summary_SVR %>% 
  pivot_wider(names_from = condition, values_from = average_rt_log)

# Extract data frame "data_rt_cond"
write.csv(df_rt_cond_summary_SVR, here("./RData/data_rt_cond.csv"), row.names = F)
```

# Create .xlsx-dataframe for response time (condition; NiiStat)
```{r}
# remove incorrect trials from data frame
data_rt_cond_NiiStat <- filter(data_raw, accuracy == "correct")

# create data frame with relevant variables 
data_rt_cond_NiiStat <- data_rt_cond_NiiStat[c('RegistryCode',
                                               'Age',
                                               'WSO',
                                               'condition',
                                               'response_time')]

# NiiStat reads low scores as impairment -> invert RT-scores
data_rt_cond_NiiStat$inverted_RT <- max(data_rt_cond_NiiStat$response_time) + 1 - data_rt_cond_NiiStat$response_time

# log-transform response time
data_rt_cond_NiiStat$response_time_log <- log(data_rt_cond_NiiStat$response_time)

# Calculate mean of response time for each participant
df_rt_cond_summary_NiiStat <- data_rt_cond_NiiStat %>% 
  group_by(RegistryCode, condition) %>% 
  mutate(average_rt_log = mean(response_time_log)) %>% 
  dplyr::select(-c("response_time_log", "response_time")) %>% 
  distinct()

# Bring it into wide-format
df_rt_cond_summary_NiiStat <- df_rt_cond_summary_NiiStat %>% 
  pivot_wider(names_from = condition, values_from = average_rt_log)

# Extract data frame "data_rt_cond.xlsx"
write_xlsx(df_rt_cond_summary_NiiStat, here("./RData/data_rt_cond.xlsx"))
```

# Create .csv-dataframe for accuracy (congruency; SVR-LSM)
```{r}
# create new data frame with relevant variables 
data_acc_congr_SVR <- data_raw[c('RegistryCode',
                                 'Age',
                                 'WSO',
                                 'Lesion_volume',
                                 'congruency',
                                 'accuracy_num')]

# Calculate mean of accuracy for each participant
df_acc_congr_summary_SVR <- data_acc_congr_SVR %>% 
  group_by(RegistryCode, congruency) %>% 
  mutate(average_accuracy = mean(accuracy_num)) %>% 
  select(-accuracy_num) %>% 
  distinct()

# Bring it into wide-format
df_acc_congr_summary_SVR <- df_acc_congr_summary_SVR %>% 
  pivot_wider(names_from = congruency, values_from = average_accuracy)

# Extract data frame "data_acc_congr"
write.csv(df_acc_congr_summary_SVR, here("./RData/data_acc_congr.csv"), row.names = F)
```

# Create .xlsx-dataframe for accuracy (congruency; NiiStat)
```{r}
# create new data frame with relevant variables 
data_acc_congr_NiiStat <- data_raw[c('RegistryCode',
                                     'Age',
                                     'WSO',
                                     'congruency',
                                     'accuracy_num')]

# Calculate mean of accuracy for each participant
df_acc_congr_summary_NiiStat <- data_acc_congr_NiiStat %>% 
  group_by(RegistryCode, congruency) %>% 
  mutate(average_accuracy = mean(accuracy_num)) %>% 
  select(-accuracy_num) %>% 
  distinct()

# Bring it into wide-format
df_acc_congr_summary_NiiStat <- df_acc_congr_summary_NiiStat %>% 
  pivot_wider(names_from = congruency, values_from = average_accuracy)

# Extract data frame "data_acc_congr.xlsx"
write_xlsx(df_acc_congr_summary_NiiStat, here("./RData/data_acc_congr.xlsx"))
```

# Create .csv-dataframe for response time (congruency; SVR-LSM)
```{r}
# remove incorrect trials from dataframe
data_rt_congr_SVR <- filter(data_raw, accuracy == "correct")

# create new data frame with relevant variables 
data_rt_congr_SVR <- data_rt_congr_SVR[c('RegistryCode',
                                         'Age',
                                         'WSO',
                                         'Lesion_volume',
                                         'congruency',
                                         'response_time')]
# log-transform response time
data_rt_congr_SVR$response_time_log <- log(data_rt_congr_SVR$response_time)

# Calculate mean of response time for each participant
df_rt_congr_summary_SVR <- data_rt_congr_SVR %>% 
  group_by(RegistryCode, congruency) %>% 
  mutate(average_rt_log = mean(response_time_log)) %>% 
  dplyr::select(-c("response_time_log", "response_time")) %>% 
  distinct()

# Bring it into wide-format
df_rt_congr_summary_SVR <- df_rt_congr_summary_SVR %>% 
  pivot_wider(names_from = congruency, values_from = average_rt_log)

# Extract data frame "data_rt_congr"
write.csv(df_rt_congr_summary_SVR, here("./RData/data_rt_congr.csv"), row.names = F)
```

# Create .xlsx-dataframe for response time (congruency; NiiStat)
```{r}
# remove incorrect trials from dataframe
data_rt_congr_NiiStat <- filter(data_raw, accuracy == "correct")

# create new data frame with relevant variables 
data_rt_congr_NiiStat <- data_rt_congr_NiiStat[c('RegistryCode',
                                                 'Age',
                                                 'WSO',
                                                 'congruency',
                                                 'response_time')]

# log-transform response time
data_rt_congr_NiiStat$response_time_log <- log(data_rt_congr_NiiStat$response_time)


# Calculate mean of response time for each participant
df_rt_congr_summary_NiiStat <- data_rt_congr_NiiStat %>% 
  group_by(RegistryCode, congruency) %>% 
  mutate(average_rt_log = mean(response_time_log)) %>% 
  dplyr::select(-c("response_time_log", "response_time")) %>% 
  distinct()

# Bring it into wide-format
df_rt_congr_summary_NiiStat <- df_rt_congr_summary_NiiStat %>% 
  pivot_wider(names_from = congruency, values_from = average_rt_log)

# Extract data frame "data_rt_congr.xlsx"
write_xlsx(df_rt_congr_summary_NiiStat, here("./RData/data_rt_congr.xlsx"))
```
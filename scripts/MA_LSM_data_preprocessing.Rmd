---
title: "MA_LSM_data_preprocessing"
author: "Siegel"
date: "2023-11-14"
output: html_document
---
# packages
```{r}
## load packages
   library(here)  
   library(tidyverse) 
```

# load data
```{r}
here::here()
load(here("./RData/all_files_11_2023.RData"))
data_raw <- all_files
```

# Data cleaning and preparing data frame
```{r}
## rename "ID" into "RegistryCode"
data_raw <- data_raw %>% 
rename(RegistryCode = ID)

## add "sub" (subject) to the RegistryCode (ID)
data_raw$RegistryCode <- paste("sub", data_raw$RegistryCode)
   
## Create as well as calculate variable 'Weeks since Onset (WSO)'
### Define variables 'test' and 'onset' as dates
data_raw$test <- as.Date(data_raw$test, format = "%d.%m.%y")
data_raw$onset <- as.Date(data_raw$onset, format = "%d.%m.%y")

### Calculate 'WSO' and define variable as a numeric data type
data_raw$WSO <- difftime(data_raw$test, data_raw$onset, units = "weeks")
data_raw$WSO <- as.numeric(data_raw$WSO)

## remove NA trials (accuracy) --> participants were too slow to react on time or didn't react at all
data_raw <- filter(data_raw, !(is.na(accuracy)))

## make numeric variable for accuracy
data_raw$accuracy_num <- ifelse(data_raw$accuracy == "correct", 1, ifelse(data_raw$accuracy == "incorrect", 0, NA))
```

# Create dataframe for accuracy (no distinction between conditions)
```{r}
## Create new data frame with relevant variables 
data_acc <- data_raw[c('RegistryCode',
                       'age',
                       'WSO',
                       'lesion_volume',
                       'resolution',
                       'TokenTest_corr',
                       'accuracy_num')]

## Calculate mean of accuracy for each participant
df_acc_summary <- data_acc %>% 
  group_by(RegistryCode) %>% 
  mutate(average_accuracy = mean(accuracy_num)) %>% 
  select(-accuracy_num) %>% 
  distinct()

## Extract data frame "data_acc_cond"
write.csv(df_acc_summary, here("./RData/data_acc.csv"), row.names = F)
```

# Create dataframe for accuracy (condition)
```{r}
## Create new data frame with relevant variables 
data_acc_cond <- data_raw[c('RegistryCode',
                            'age',
                            'WSO',
                            'lesion_volume',
                            'resolution',
                            'TokenTest_corr',
                            'condition',
                            'accuracy_num')]

## Calculate mean of accuracy for each participant
df_acc_cond_summary <- data_acc_cond %>% 
  group_by(RegistryCode, condition) %>% 
  mutate(average_accuracy = mean(accuracy_num)) %>% 
  select(-accuracy_num) %>% 
  distinct()

## Bring it into wide-format
df_acc_cond_summary <- df_acc_cond_summary %>% 
  pivot_wider(names_from = condition, values_from = average_accuracy)

## Extract data frame "data_acc_cond"
write.csv(df_acc_cond_summary, here("./RData/data_acc_cond.csv"), row.names = F)
```

# Create dataframe for response time (condition)
```{r}
## remove incorrect trials from data frame
data_rt_cond <- filter(data_raw, accuracy == "correct")

## create data frame with relevant variables 
data_rt_cond <- data_rt_cond[c('RegistryCode',
                               'age',
                               'WSO',
                               'lesion_volume',
                               'resolution',
                               'TokenTest_corr',
                               'condition',
                               'response_time')]

## Calculate mean of response time for each participant
df_rt_cond_summary <- data_rt_cond %>% 
  group_by(RegistryCode, condition) %>% 
  mutate(average_rt = mean(response_time)) %>% 
  select(-response_time) %>% 
  distinct()

## Bring it into wide-format
df_rt_cond_summary <- df_rt_cond_summary %>% 
  pivot_wider(names_from = condition, values_from = average_rt)

## log-transform response time
### WPM
df_rt_cond_summary$WPM_log <- log(df_rt_cond_summary$WPM)

### FPM
df_rt_cond_summary$FPM_log <- log(df_rt_cond_summary$FPM)

## extract data frame "data_rt_cond"
write.csv(df_rt_cond_summary, here("./RData/data_rt_cond.csv"), row.names = F)
```

# Create dataframe for accuracy (congruency)
```{r}
## create new data frame with relevant variables 
data_acc_congr <- data_raw[c('RegistryCode',
                             'age',
                             'WSO',
                             'lesion_volume',
                             'resolution',
                             'TokenTest_corr',
                             'congruency',
                             'accuracy_num')]

## Calculate mean of accuracy for each participant
df_acc_congr_summary <- data_acc_congr %>% 
  group_by(RegistryCode, congruency) %>% 
  mutate(average_accuracy = mean(accuracy_num)) %>% 
  select(-accuracy_num) %>% 
  distinct()

## Bring it into wide-format
df_acc_congr_summary <- df_acc_congr_summary %>% 
  pivot_wider(names_from = congruency, values_from = average_accuracy)

## extract data frame "data_acc_congr"
write.csv(df_acc_congr_summary, here("./RData/data_acc_congr.csv"), row.names = F)
```

# Create dataframe for response time (congruency)
```{r}
## remove incorrect trials from dataframe
data_rt_congr <- filter(data_raw, accuracy == "correct")

## create new data frame with relevant variables 
data_rt_congr <- data_rt_congr[c('RegistryCode',
                                 'age',
                                 'WSO',
                                 'lesion_volume',
                                 'resolution',
                                 'TokenTest_corr',
                                 'congruency',
                                 'response_time')]

## Calculate mean of response time for each participant
df_rt_congr_summary <- data_rt_congr %>% 
  group_by(RegistryCode, congruency) %>% 
  mutate(average_rt = mean(response_time)) %>% 
  select(-response_time) %>% 
  distinct()

## Bring it into wide-format
df_rt_congr_summary <- df_rt_congr_summary %>% 
  pivot_wider(names_from = congruency, values_from = average_rt)

## log-transform response time
### congruent
df_rt_congr_summary$congruent_log <- log(df_rt_congr_summary$congruent)

### incongruent
df_rt_congr_summary$incongruent_log <- log(df_rt_congr_summary$incongruent)


## extract data frame "data_rt_congr"
write.csv(df_rt_congr_summary, here("./RData/data_rt_congr.csv"), row.names = F)
```